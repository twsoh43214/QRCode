<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QR Bulk Label Generator - 10 Per Sheet</title>

<style>
/* ===== Screen ===== */
body{
  font-family: -apple-system, system-ui, Arial, sans-serif;
  margin: 20px;
}

.controls{ margin-bottom: 20px; }

textarea{
  width: 100%;
  height: 140px;
  font-size: 16px;
  padding: 10px;
}

button{
  font-size: 16px;
  padding: 10px 16px;
  margin-right: 8px;
  margin-top: 10px;
}

/* ===== Print ===== */
@page{
  size: letter;
  margin: 0.5in; /* important: makes math predictable */
}

.pages{
  display: grid;
  gap: 18px; /* space between pages on screen only */
}

/* One printed page = EXACTLY 10 labels (2 cols x 5 rows) */
.page{
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: repeat(5, 2in); /* 5 rows */
  gap: 0; /* no gaps = predictable */
  position: relative;
}

/* Vertical cut line between columns */
.page::before{
  content:"";
  position:absolute;
  top:0;
  bottom:0;
  left:50%;
  border-left: 1px dashed #aaa;
  pointer-events:none;
}

/* Each label cell */
.label{
  box-sizing: border-box;
  height: 2in;                 /* matches grid row height */
  display: grid;
  grid-template-columns: 1.35in 1fr;  /* QR col + text col */
  align-items: center;
  column-gap: 0.18in;
  padding: 0.12in;
  border: 1px dashed #bbb;     /* cut box */
}

/* QR size */
.qr img{
  width: 1.35in;
  height: 1.35in;
  display:block;
  image-rendering: pixelated;
}

/* Big bold, no wrap */
.text{
  font-size: 36px;
  font-weight: 800;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

@media print{
  body{ margin: 0; }
  .controls{ display:none; }
  .pages{ gap: 0; }

  /* Force clean page breaks */
  .page{ break-after: page; page-break-after: always; }
  .page:last-child{ break-after: auto; page-break-after: auto; }

  /* Encourage printing of dashed lines */
  *{ -webkit-print-color-adjust: exact; print-color-adjust: exact; }
}
</style>
</head>

<body>

<div class="controls">
  <h2>QR Bulk Label Generator (10 Per Sheet)</h2>
  <p>Supports lists + ranges: <code>RTF-1:30</code>, <code>RTF-01..12</code>, <code>RTF-1,RTF-3:7</code></p>

  <textarea id="bulkInput" placeholder="Example:
RTF-1:RTF-30"></textarea>

  <br>
  <button onclick="generateBulk()">Generate</button>
  <button onclick="window.print()">Print</button>
  <button onclick="clearLabels()">Clear</button>
</div>

<div id="preview" class="pages"></div>

<script>
function qrUrl(data){
  const size = 900;      // high resolution
  const margin = 12;     // quiet zone
  const ecc = "Q";
  return (
    "https://api.qrserver.com/v1/create-qr-code/?" +
    "format=png" +
    "&size=" + size + "x" + size +
    "&margin=" + margin +
    "&ecc=" + ecc +
    "&data=" + encodeURIComponent(data)
  );
}

/* ---------- Range parsing ---------- */
function parseTrailingNumber(token){
  const m = token.match(/^(.*?)(\d+)$/);
  if(!m) return null;
  return { prefix: m[1], numStr: m[2], num: parseInt(m[2],10) };
}

function expandRangeToken(token){
  let op = null;
  if(token.includes("..")) op = "..";
  else if(token.includes(":")) op = ":";

  if(!op) return null;

  const parts = token.split(op).map(t => t.trim());
  if(parts.length !== 2) return null;

  const [a,b] = parts;
  const pa = parseTrailingNumber(a);
  if(!pa) return null;

  let pb;
  if(/^\d+$/.test(b)){
    pb = { prefix: pa.prefix, numStr: b, num: parseInt(b,10) };
  }else{
    pb = parseTrailingNumber(b);
    if(!pb) return null;
  }

  if(pa.prefix !== pb.prefix) return null;

  const width = pa.numStr.length;
  const step  = pa.num <= pb.num ? 1 : -1;
  const out = [];

  for(let n = pa.num; step > 0 ? n <= pb.num : n >= pb.num; n += step){
    out.push(pa.prefix + String(n).padStart(width, "0"));
  }
  return out;
}

function expandAll(text){
  const tokens = text.replace(/,/g," ").split(/\s+/).map(t => t.trim()).filter(Boolean);
  const out = [];
  for(const t of tokens){
    const ex = expandRangeToken(t);
    if(ex) out.push(...ex);
    else out.push(t);
  }
  return out;
}

/* ---------- Rendering ---------- */
function makeLabel(code){
  const label = document.createElement("div");
  label.className = "label";

  const qrDiv = document.createElement("div");
  qrDiv.className = "qr";

  const img = document.createElement("img");
  img.src = qrUrl(code);
  img.alt = "QR";
  qrDiv.appendChild(img);

  const text = document.createElement("div");
  text.className = "text";
  text.textContent = code.toUpperCase();

  label.appendChild(qrDiv);
  label.appendChild(text);
  return label;
}

function generateBulk(){
  const codes = expandAll(document.getElementById("bulkInput").value);
  const preview = document.getElementById("preview");
  preview.innerHTML = "";

  // Chunk into pages of 10
  for(let i = 0; i < codes.length; i += 10){
    const pageCodes = codes.slice(i, i + 10);

    const page = document.createElement("div");
    page.className = "page";

    // Fill exactly 10 slots; if last page has fewer, leave blanks
    for(let j = 0; j < 10; j++){
      if(j < pageCodes.length){
        page.appendChild(makeLabel(pageCodes[j]));
      }else{
        // empty cell to preserve 2x5 grid
        const blank = document.createElement("div");
        blank.className = "label";
        blank.style.visibility = "hidden";
        page.appendChild(blank);
      }
    }

    preview.appendChild(page);
  }
}

function clearLabels(){
  document.getElementById("preview").innerHTML = "";
  document.getElementById("bulkInput").value = "";
}
</script>

</body>
</html>
