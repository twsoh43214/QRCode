<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QR Label Printer (57mm Thermal)</title>

<style>
:root{
  --paper-width-mm: 57;
  --paper-width: calc(var(--paper-width-mm) * 1mm);
  --qr-size-mm: 30;
}

body{
  font-family: -apple-system, system-ui, Arial, sans-serif;
  margin: 15px;
}

.controls{ margin-bottom: 20px; }

input, select, button{
  font-size: 16px;
  padding: 8px;
  margin: 4px 0;
}

.preview{
  display: grid;
  gap: 10px;
}

.label{
  width: var(--paper-width);
  padding: 3mm 2mm;
  display: grid;
  grid-template-columns: auto 1fr; /* QR left, text right */
  align-items: center;
  column-gap: 3mm;
  page-break-inside: avoid;
  break-inside: avoid;
}

.qr{
  width: calc(var(--qr-size-mm) * 1mm);
  height: calc(var(--qr-size-mm) * 1mm);
}

.qr img{
  width: 100%;
  height: 100%;
  display: block;
  image-rendering: pixelated;
}

.text{
  font-size: 16px;
  word-break: break-all;
}

@media print{
  body{ margin:0; }
  .controls{ display:none; }
}
</style>
</head>

<body>

<div class="controls">
  <h3>QR Label Generator</h3>

  <div>
    <label>Code to Encode:</label><br>
    <input id="codeInput" placeholder="e.g. RTF-1 or D12345678x1" />
  </div>

  <button onclick="addLabel()">Generate</button>
  <button onclick="window.print()">Print</button>
  <button onclick="clearLabels()">Clear</button>
</div>

<div id="preview" class="preview"></div>

<script>
function qrPngUrl(data){
  const size = 800;     // high resolution
  const margin = 12;    // quiet zone
  const ecc = "Q";

  return (
    "https://api.qrserver.com/v1/create-qr-code/?" +
    "format=png" +
    "&size=" + size + "x" + size +
    "&margin=" + margin +
    "&ecc=" + ecc +
    "&data=" + encodeURIComponent(data)
  );
}

function normalizeInput(str){
  return str
    .replace(/\u00A0/g, " ")
    .replace(/\s+/g, " ")
    .trim();
}

function escapeHtml(str){
  return str.replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
  }[c]));
}

function addLabel(){
  const raw = document.getElementById("codeInput").value;
  const code = normalizeInput(raw);
  if(!code) return;

  const preview = document.getElementById("preview");

  const label = document.createElement("div");
  label.className = "label";

  const qrWrap = document.createElement("div");
  qrWrap.className = "qr";

  const img = document.createElement("img");
  img.alt = "QR";
  img.src = qrPngUrl(code);

  qrWrap.appendChild(img);

  const text = document.createElement("div");
  text.className = "text";
  text.innerHTML = escapeHtml(code);

  label.appendChild(qrWrap);
  label.appendChild(text);
  preview.appendChild(label);

  document.getElementById("codeInput").value = "";
}

function clearLabels(){
  document.getElementById("preview").innerHTML = "";
}
</script>

</body>
</html>
