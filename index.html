<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QR Label Printer (57mm Thermal)</title>

<style>
:root{
  --paper-width-mm: 57;
  --paper-width: calc(var(--paper-width-mm) * 1mm);
  --qr-size-mm: 32;
}

body{
  font-family: -apple-system, system-ui, Arial, sans-serif;
  margin: 15px;
}

.controls{ margin-bottom: 20px; }

input, select, button{
  font-size: 16px;
  padding: 8px;
  margin: 4px 0;
}

.preview{
  display: grid;
  gap: 10px;
}

.label{
  width: var(--paper-width);
  padding: 3mm 2mm;
  display: grid;
  grid-template-columns: 1fr;
  justify-items: start;
  page-break-inside: avoid;
  break-inside: avoid;
}

.qr{
  width: calc(var(--qr-size-mm) * 1mm);
  height: calc(var(--qr-size-mm) * 1mm);
}

.qr img{
  width: 100%;
  height: 100%;
  display: block;
  /* Helps keep edges crisp when scaled */
  image-rendering: pixelated;
}

.text{
  margin-top: 2mm;
  font-size: 14px;
  line-height: 1.2;
}

.dept{
  font-weight: 700;
  font-size: 18px;
}

.small{ font-size: 12px; }

@media print{
  body{ margin:0; }
  .controls{ display:none; }
}
</style>
</head>

<body>

<div class="controls">
  <h3>QR Label Generator (Thermal Optimized)</h3>

  <div>
    <label>Department:</label><br>
    <select id="dept">
      <option>RTF</option>
      <option>FRAMED</option>
      <option>STRETCHED</option>
      <option>RTP</option>
    </select>
  </div>

  <div>
    <label>Order / Location ID:</label><br>
    <input id="codeInput" placeholder="e.g. RTF-1 or D12345678x1" />
  </div>

  <button onclick="addLabel()">Generate</button>
  <button onclick="window.print()">Print</button>
  <button onclick="clearLabels()">Clear</button>
</div>

<div id="preview" class="preview"></div>

<script>
function qrPngUrl(data){
  const size = 800;     // high resolution for thermal
  const margin = 12;    // quiet zone
  const ecc = "Q";      // error correction

  return (
    "https://api.qrserver.com/v1/create-qr-code/?" +
    "format=png" +
    "&size=" + size + "x" + size +
    "&margin=" + margin +
    "&ecc=" + ecc +
    "&data=" + encodeURIComponent(data)
  );
}

function escapeHtml(str){
  return str.replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[c]));
}

function normalizeInput(str){
  // Remove hidden whitespace that can sneak in from scanners/paste
  return str
    .replace(/\u00A0/g, " ")      // non-breaking space
    .replace(/\s+/g, " ")         // collapse whitespace
    .trim();
}

async function addLabel(){
  const dept = document.getElementById("dept").value;
  const raw = document.getElementById("codeInput").value;
  const code = normalizeInput(raw);
  if(!code) return;

  const preview = document.getElementById("preview");

  const label = document.createElement("div");
  label.className = "label";

  const qrWrap = document.createElement("div");
  qrWrap.className = "qr";

  const img = document.createElement("img");
  img.alt = "QR";
  img.src = qrPngUrl(code);

  qrWrap.appendChild(img);

  const text = document.createElement("div");
  text.className = "text";
  text.innerHTML = `
    <div class="dept">${escapeHtml(dept)}</div>
    <div>${escapeHtml(code)}</div>
    <div class="small">${new Date().toLocaleString()}</div>
  `;

  label.appendChild(qrWrap);
  label.appendChild(text);
  preview.appendChild(label);

  document.getElementById("codeInput").value = "";
}

function clearLabels(){
  document.getElementById("preview").innerHTML = "";
}
</script>

</body>
</html>
